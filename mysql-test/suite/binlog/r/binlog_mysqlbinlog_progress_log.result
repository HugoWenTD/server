reset master;
set timestamp=1000000000;
create table t1 (a int);
insert into t1 values (1);
insert into t1 values (2);
insert into t1 values (3);
update t1 set a=a+2 where a=2;
update t1 set a=a+2 where a=3;
flush logs;

--- parse binlog and verify progress-log ---
--- binlog output ---
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!40019 SET @@session.max_insert_delayed_threads=0*/;
/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
ROLLBACK/*!*/;
use `test`/*!*/;
SET TIMESTAMP=1000000000/*!*/;
SET @@session.pseudo_thread_id=999999999/*!*/;
SET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1, @@session.check_constraint_checks=1, @@session.sql_if_exists=0/*!*/;
SET @@session.sql_mode=1411383296/*!*/;
SET @@session.auto_increment_increment=1, @@session.auto_increment_offset=1/*!*/;
/*!\C latin1 *//*!*/;
SET @@session.character_set_client=8,@@session.collation_connection=8,@@session.collation_server=8/*!*/;
SET @@session.lc_time_names=0/*!*/;
SET @@session.collation_database=DEFAULT/*!*/;
create table t1 (a int)
/*!*/;
START TRANSACTION
/*!*/;
# Annotate_rows:
#Q> insert into t1 values (1)
SET TIMESTAMP=1000000000/*!*/;
COMMIT
/*!*/;
START TRANSACTION
/*!*/;
# Annotate_rows:
#Q> insert into t1 values (2)
SET TIMESTAMP=1000000000/*!*/;
COMMIT
/*!*/;
START TRANSACTION
/*!*/;
# Annotate_rows:
#Q> insert into t1 values (3)
SET TIMESTAMP=1000000000/*!*/;
COMMIT
/*!*/;
START TRANSACTION
/*!*/;
# Annotate_rows:
#Q> update t1 set a=a+2 where a=2
SET TIMESTAMP=1000000000/*!*/;
COMMIT
/*!*/;
START TRANSACTION
/*!*/;
# Annotate_rows:
#Q> update t1 set a=a+2 where a=3
SET TIMESTAMP=1000000000/*!*/;
COMMIT
/*!*/;
DELIMITER ;
# End of log file
ROLLBACK /* added by mysqlbinlog */;
/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;

--- progress log output ---
# OPEN /master-bin.000001 with starting position 4
# EOF reached on /master-bin.000001 at position 1768
# LAST applied event: logfile /master-bin.000001 Time: XXX Pos: 1720
EXIT

--- parse binlog with --stop-position and verify progress-log ---
--- binlog output ---
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=1*/;
/*!40019 SET @@session.max_insert_delayed_threads=0*/;
/*!50003 SET @OLD_COMPLETION_TYPE=@@COMPLETION_TYPE,COMPLETION_TYPE=0*/;
DELIMITER /*!*/;
ROLLBACK/*!*/;
DELIMITER ;
# End of log file
ROLLBACK /* added by mysqlbinlog */;
/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;
/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;

--- progress log output ---
# OPEN /master-bin.000001 with starting position 256
# FINAL applied event: logfile /master-bin.000001 Time: XXX Pos: 256
# STOP event (not applied): logfile /master-bin.000001 Time: XXX Pos: 285
EXIT
